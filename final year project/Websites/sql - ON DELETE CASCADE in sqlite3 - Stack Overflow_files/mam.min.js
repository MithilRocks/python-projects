var requirejs,require,define;(function(Y){function I(e){return"[object Function]"===L.call(e)}function J(e){return"[object Array]"===L.call(e)}function x(e,t){if(e){var n;for(n=0;n<e.length&&(!e[n]||!t(e[n],n,e));n+=1);}}function M(e,t){if(e){var n;for(n=e.length-1;-1<n&&(!e[n]||!t(e[n],n,e));n-=1);}}function r(e,t){return da.call(e,t)}function i(e,t){return r(e,t)&&e[t]}function E(e,t){for(var n in e)if(r(e,n)&&t(e[n],n))break}function Q(e,t,n,i){return t&&E(t,function(t,s){if(n||!r(e,s))i&&"string"!=typeof t?(e[s]||(e[s]={}),Q(e[s],t,n,i)):e[s]=t}),e}function t(e,t){return function(){return t.apply(e,arguments)}}function Z(e){if(!e)return e;var t=Y;return x(e.split("."),function(e){t=t[e]}),t}function F(e,t,n,r){return t=Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e),t.requireType=e,t.requireModules=r,n&&(t.originalError=n),t}function ea(e){function n(e,t,n){var r,s,o,u,a,f,l,c=t&&t.split("/");r=c;var h=C.map,p=h&&h["*"];if(e&&"."===e.charAt(0))if(t){r=i(C.pkgs,t)?c=[t]:c.slice(0,c.length-1),t=e=r.concat(e.split("/"));for(r=0;t[r];r+=1)if(s=t[r],"."===s)t.splice(r,1),r-=1;else if(".."===s){if(1===r&&(".."===t[2]||".."===t[0]))break;0<r&&(t.splice(r-1,2),r-=2)}r=i(C.pkgs,t=e[0]),e=e.join("/"),r&&e===t+"/"+r.main&&(e=t)}else 0===e.indexOf("./")&&(e=e.substring(2));if(n&&(c||p)&&h){t=e.split("/");for(r=t.length;0<r;r-=1){o=t.slice(0,r).join("/");if(c)for(s=c.length;0<s;s-=1)if(n=i(h,c.slice(0,s).join("/")))if(n=i(n,o)){u=n,a=r;break}if(u)break;!f&&p&&i(p,o)&&(f=i(p,o),l=r)}!u&&f&&(u=f,a=l),u&&(t.splice(0,a,u),e=t.join("/"))}return e}function s(e){z&&x(document.getElementsByTagName("script"),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===S.contextName)return t.parentNode.removeChild(t),!0})}function o(e){var t=i(C.paths,e);if(t&&J(t)&&1<t.length)return s(e),t.shift(),S.require.undef(e),S.require([e]),!0}function u(e){var t,n=e?e.indexOf("!"):-1;return-1<n&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function a(e,t,r,s){var o,a,f=null,l=t?t.name:null,c=e,h=!0,p="";return e||(h=!1,e="_@r"+(D+=1)),e=u(e),f=e[0],e=e[1],f&&(f=n(f,l,s),a=i(M,f)),e&&(f?p=a&&a.normalize?a.normalize(e,function(e){return n(e,l,s)}):n(e,l,s):(p=n(e,l,s),e=u(p),f=e[0],p=e[1],r=!0,o=S.nameToUrl(p))),r=f&&!a&&!r?"_unnormalized"+(H+=1):"",{prefix:f,name:p,parentMap:t,unnormalized:!!r,url:o,originalName:c,isDefine:h,id:(f?f+"!"+p:p)+r}}function f(e){var t=e.id,n=i(k,t);return n||(n=k[t]=new S.Module(e)),n}function c(e,t,n){var s=e.id,o=i(k,s);r(M,s)&&(!o||o.defineEmitComplete)?"defined"===t&&n(M[s]):f(e).on(t,n)}function h(e,t){var n=e.requireModules,r=!1;t?t(e):(x(n,function(t){if(t=i(k,t))t.error=e,t.events.error&&(r=!0,t.emit("error",e))}),!r)&&l.onError(e)}function p(){R.length&&(fa.apply(A,[A.length-1,0].concat(R)),R=[])}function d(e,t,n){var r=e.map.id;e.error?e.emit("error",e.error):(t[r]=!0,x(e.depMaps,function(r,s){var o=r.id,u=i(k,o);u&&!e.depMatched[s]&&!n[o]&&(i(t,o)?(e.defineDep(s,M[o]),e.check()):d(u,t,n))}),n[r]=!0)}function v(){var e,t,n,r,i=(n=1e3*C.waitSeconds)&&S.startTime+n<(new Date).getTime(),u=[],a=[],f=!1,l=!0;if(!b){b=!0,E(k,function(n){e=n.map,t=e.id;if(n.enabled&&(e.isDefine||a.push(n),!n.error))if(!n.inited&&i)o(t)?f=r=!0:(u.push(t),s(t));else if(!n.inited&&n.fetched&&e.isDefine&&(f=!0,!e.prefix))return l=!1});if(i&&u.length)return n=F("timeout","Load timeout for modules: "+u,null,u),n.contextName=S.contextName,h(n);l&&x(a,function(e){d(e,{},{})}),(!i||r)&&f&&(z||$)&&!N&&(N=setTimeout(function(){N=0,v()},50)),b=!1}}function m(e){r(M,e[0])||f(a(e[0],null,!0)).init(e[1],e[2])}function g(e){var e=e.currentTarget||e.srcElement,t=S.onScriptLoad;return e.detachEvent&&!V?e.detachEvent("onreadystatechange",t):e.removeEventListener("load",t,!1),t=S.onScriptError,(!e.detachEvent||V)&&e.removeEventListener("error",t,!1),{node:e,id:e&&e.getAttribute("data-requiremodule")}}function y(){var e;for(p();A.length;){e=A.shift();if(null===e[0])return h(F("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));m(e)}}var b,w,S,T,N,C={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},map:{},config:{}},k={},L={},A=[],M={},_={},D=1,H=1;return T={require:function(e){return e.require?e.require:e.require=S.makeRequire(e.map)},exports:function(e){e.usingExports=!0;if(e.map.isDefine)return e.exports?e.exports:e.exports=M[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return C.config&&i(C.config,e.map.id)||{}},exports:M[e.map.id]}}},w=function(e){this.events=i(L,e.id)||{},this.map=e,this.shim=i(C.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},w.prototype={init:function(e,n,r,i){i=i||{},this.inited||(this.factory=n,r?this.on("error",r):this.events.error&&(r=t(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=r,this.inited=!0,this.ignore=i.ignore,i.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,S.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();S.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],t(this,function(){return e.prefix?this.callPlugin():this.load()}))}},load:function(){var e=this.map.url;_[e]||(_[e]=!0,S.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,n=this.map.id;t=this.depExports;var r=this.exports,i=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){this.defining=!0;if(1>this.depCount&&!this.defined){if(I(i)){if(this.events.error)try{r=S.execCb(n,i,t,r)}catch(s){e=s}else r=S.execCb(n,i,t,r);this.map.isDefine&&((t=this.module)&&void 0!==t.exports&&t.exports!==this.exports?r=t.exports:void 0===r&&this.usingExports&&(r=this.exports));if(e)return e.requireMap=this.map,e.requireModules=[this.map.id],e.requireType="define",h(this.error=e)}else r=i;this.exports=r,this.map.isDefine&&!this.ignore&&(M[n]=r,l.onResourceLoad)&&l.onResourceLoad(S,this.map,this.depMaps),delete k[n],this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var e=this.map,s=e.id,o=a(e.prefix);this.depMaps.push(o),c(o,"defined",t(this,function(o){var u,p;p=this.map.name;var d=this.map.parentMap?this.map.parentMap.name:null,v=S.makeRequire(e.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){if(o.normalize&&(p=o.normalize(p,function(e){return n(e,d,!0)})||""),o=a(e.prefix+"!"+p,this.map.parentMap),c(o,"defined",t(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),p=i(k,o.id))this.depMaps.push(o),this.events.error&&p.on("error",t(this,function(e){this.emit("error",e)})),p.enable()}else u=t(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),u.error=t(this,function(e){this.inited=!0,this.error=e,e.requireModules=[s],E(k,function(e){0===e.map.id.indexOf(s+"_unnormalized")&&delete k[e.map.id]}),h(e)}),u.fromText=t(this,function(t,n){var i=e.name,o=a(i),c=O;n&&(t=n),c&&(O=!1),f(o),r(C.config,s)&&(C.config[i]=C.config[s]);try{l.exec(t)}catch(p){return h(F("fromtexteval","fromText eval for "+s+" failed: "+p,p,[s]))}c&&(O=!0),this.depMaps.push(o),S.completeLoad(i),v([i],u)}),o.load(e.name,v,u,C)})),S.enable(o,this),this.pluginMaps[o.id]=o},enable:function(){this.enabling=this.enabled=!0,x(this.depMaps,t(this,function(e,n){var s,o;if("string"==typeof e){e=a(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[n]=e;if(s=i(T,e.id)){this.depExports[n]=s(this);return}this.depCount+=1,c(e,"defined",t(this,function(e){this.defineDep(n,e),this.check()})),this.errback&&c(e,"error",this.errback)}s=e.id,o=k[s],!r(T,s)&&o&&!o.enabled&&S.enable(e,this)})),E(this.pluginMaps,t(this,function(e){var t=i(k,e.id);t&&!t.enabled&&S.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){x(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},S={config:C,contextName:e,registry:k,defined:M,urlFetched:_,defQueue:A,Module:w,makeModuleMap:a,nextTick:l.nextTick,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=C.pkgs,n=C.shim,r={paths:!0,config:!0,map:!0};E(e,function(e,t){r[t]?"map"===t?Q(C[t],e,!0,!0):Q(C[t],e,!0):C[t]=e}),e.shim&&(E(e.shim,function(e,t){J(e)&&(e={deps:e}),(e.exports||e.init)&&!e.exportsFn&&(e.exportsFn=S.makeShimExports(e)),n[t]=e}),C.shim=n),e.packages&&(x(e.packages,function(e){e="string"==typeof e?{name:e}:e,t[e.name]={name:e.name,location:e.location||e.name,main:(e.main||"main").replace(ga,"").replace(aa,"")}}),C.pkgs=t),E(k,function(e,t){!e.inited&&!e.map.unnormalized&&(e.map=a(t))}),(e.deps||e.callback)&&S.require(e.deps||[],e.callback)},makeShimExports:function(e){return function(){var t;return e.init&&(t=e.init.apply(Y,arguments)),t||e.exports&&Z(e.exports)}},makeRequire:function(t,s){function o(n,i,u){var c,p;return s.enableBuildCallback&&i&&I(i)&&(i.__requireJsBuild=!0),"string"==typeof n?I(i)?h(F("requireargs","Invalid require call"),u):t&&r(T,n)?T[n](k[t.id]):l.get?l.get(S,n,t):(c=a(n,t,!1,!0),c=c.id,r(M,c)?M[c]:h(F("notloaded",'Module name "'+c+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(y(),S.nextTick(function(){y(),p=f(a(null,t)),p.skipMap=s.skipMap,p.init(n,i,u,{enabled:!0}),v()}),o)}return s=s||{},Q(o,{isBrowser:z,toUrl:function(e){var r,i=e.lastIndexOf("."),s=e.split("/")[0];return-1!==i&&("."!==s&&".."!==s||1<i)&&(r=e.substring(i,e.length),e=e.substring(0,i)),e=S.nameToUrl(n(e,t&&t.id,!0),r||".fake"),r?e:e.substring(0,e.length-5)},defined:function(e){return r(M,a(e,t,!1,!0).id)},specified:function(e){return e=a(e,t,!1,!0).id,r(M,e)||r(k,e)}}),t||(o.undef=function(e){p();var n=a(e,t,!0),r=i(k,e);delete M[e],delete _[n.url],delete L[e],r&&(r.events.defined&&(L[e]=r.events),delete k[e])}),o},enable:function(e){i(k,e.id)&&f(e).enable()},completeLoad:function(e){var t,n,s=i(C.shim,e)||{},u=s.exports;for(p();A.length;){n=A.shift();if(null===n[0]){n[0]=e;if(t)break;t=!0}else n[0]===e&&(t=!0);m(n)}n=i(k,e);if(!t&&!r(M,e)&&n&&!n.inited){if(C.enforceDefine&&(!u||!Z(u)))return o(e)?void 0:h(F("nodefine","No define call for "+e,null,[e]));m([e,s.deps||[],s.exportsFn])}v()},nameToUrl:function(e,t){var n,r,s,o,u,a;if(l.jsExtRegExp.test(e))o=e+(t||"");else{n=C.paths,r=C.pkgs,o=e.split("/");for(u=o.length;0<u;u-=1){if(a=o.slice(0,u).join("/"),s=i(r,a),a=i(n,a)){J(a)&&(a=a[0]),o.splice(0,u,a);break}if(s){n=e===s.name?s.location+"/"+s.main:s.location,o.splice(0,u,n);break}}o=o.join("/"),o+=t||(/\?/.test(o)?"":".js"),o=("/"===o.charAt(0)||o.match(/^[\w\+\.\-]+:/)?"":C.baseUrl)+o}return C.urlArgs?o+((-1===o.indexOf("?")?"?":"&")+C.urlArgs):o},load:function(e,t){l.load(S,e,t)},execCb:function(e,t,n,r){return t.apply(r,n)},onScriptLoad:function(e){if("load"===e.type||ha.test((e.currentTarget||e.srcElement).readyState))P=null,e=g(e),S.completeLoad(e.id)},onScriptError:function(e){var t=g(e);if(!o(t.id))return h(F("scripterror","Script error",e,[t.id]))}},S.require=S.makeRequire(),S}var l,w,B,D,s,H,P,K,ba,ca,ia=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,ja=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,aa=/\.js$/,ga=/^\.\//;w=Object.prototype;var L=w.toString,da=w.hasOwnProperty,fa=Array.prototype.splice,z="undefined"!=typeof window&&!!navigator&&!!document,$=!z&&"undefined"!=typeof importScripts,ha=z&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,V="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),C={},q={},R=[],O=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(I(requirejs))return;q=requirejs,requirejs=void 0}"undefined"!=typeof require&&!I(require)&&(q=require,require=void 0),l=requirejs=function(e,t,n,r){var s,o="_";return!J(e)&&"string"!=typeof e&&(s=e,J(t)?(e=t,t=n,n=r):e=[]),s&&s.context&&(o=s.context),(r=i(C,o))||(r=C[o]=l.s.newContext(o)),s&&r.configure(s),r.require(e,t,n)},l.config=function(e){return l(e)},l.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=l),l.version="2.1.4",l.jsExtRegExp=/^\/|:|\?|\.js$/,l.isBrowser=z,w=l.s={contexts:C,newContext:ea},l({}),x(["toUrl","undef","defined","specified"],function(e){l[e]=function(){var t=C._;return t.require[e].apply(t,arguments)}}),z&&(B=w.head=document.getElementsByTagName("head")[0],D=document.getElementsByTagName("base")[0])&&(B=w.head=D.parentNode),l.onError=function(e){throw e},l.load=function(e,t,n){var r=e&&e.config||{},i;if(z)return i=r.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),i.type=r.scriptType||"text/javascript",i.charset="utf-8",i.async=!0,i.setAttribute("data-requirecontext",e.contextName),i.setAttribute("data-requiremodule",t),i.attachEvent&&!(i.attachEvent.toString&&0>i.attachEvent.toString().indexOf("[native code"))&&!V?(O=!0,i.attachEvent("onreadystatechange",e.onScriptLoad)):(i.addEventListener("load",e.onScriptLoad,!1),i.addEventListener("error",e.onScriptError,!1)),i.src=n,K=i,D?B.insertBefore(i,D):B.appendChild(i),K=null,i;$&&(importScripts(n),e.completeLoad(t))},z&&M(document.getElementsByTagName("script"),function(e){B||(B=e.parentNode);if(s=e.getAttribute("data-main"))return q.baseUrl||(H=s.split("/"),ba=H.pop(),ca=H.length?H.join("/")+"/":"./",q.baseUrl=ca,s=ba),s=s.replace(aa,""),q.deps=q.deps?q.deps.concat(s):[s],!0}),define=function(e,t,n){var r,i;"string"!=typeof e&&(n=t,t=e,e=null),J(t)||(n=t,t=[]),!t.length&&I(n)&&n.length&&(n.toString().replace(ia,"").replace(ja,function(e,n){t.push(n)}),t=(1===n.length?["require"]:["require","exports","module"]).concat(t)),O&&((r=K)||(P&&"interactive"===P.readyState||M(document.getElementsByTagName("script"),function(e){if("interactive"===e.readyState)return P=e}),r=P),r&&(e||(e=r.getAttribute("data-requiremodule")),i=C[r.getAttribute("data-requirecontext")])),(i?i.defQueue:R).push([e,t,n])},define.amd={jQuery:!0},l.exec=function(b){return eval(b)},l(q)}})(this),define("requireLib",function(){}),define("mamApi",[],function(){return{jsInjection:JSInjection,launchGadget:LaunchGadget,getMainFrameUrl:function(){return!$.browser.webkit||GetInfo().context.host==="Extension"?GetMainFrameUrl():window.mamNavCompleteMainFrameUrl||GetMainFrameUrl()},getToolbarId:GetToolbarId,removeWebApp:RemoveWebApp,crossDomainHttpRequest:CrossDomainHttpRequest,storeGlobalKey:StoreGlobalKey,sendMessage:SendMessage,getInfo:GetInfo,retrieveGlobalKey:RetrieveGlobalKey,deleteGlobalKey:DeleteGlobalKey,navigateInMainFrame:NavigateInMainFrame,navigateInNewTab:NavigateInNewTab,closeFloatingWindow:CloseFloatingWindow,createNestedContext:CreateNestedContext,executeScriptInFrame:ExecuteScriptInFrame,addWebApp:AddWebApp,triggerWebAppEvent:TriggerWebAppEvent,getVersion:GetVersion,onToolbarReady:OnToolbarReady}}),define("utils",[],function(){var e=function(e){return e?(e=e.indexOf("http")===0?e:"http://"+e,e.match(/:\/\/(?:(w{3}\.))?(.[^/]+)/)[2]):""},t=function(e,t){var n;return e.indexOf("#")!==-1&&(e=e.split("#")[0]),n=e.match("[?&]"+t+"=([^&]+)","i"),n&&n.length>1?decodeURIComponent(n[1]):""},n=function(e){return e===null||e===""?null:(e=e.toLowerCase(),e==="false"||e==="0"?!1:e==="true"||e==="1"?!0:!!e)},r=function(e,t){return!e||!t?!0:e+t<(new Date).getTime()},i=function(e,t){var n=e.split("."),r=t.split("."),i=function(e,t){return e=parseInt(e,10),t=parseInt(t,10),t>e?-1:t<e?1:0},s,o;for(o=0;o<4;o++){s=i(n[o],r[o]);if(s!==0)return s}return 0},s=function(e){return e?(e^Math.random()*16>>e/4).toString(16):([1e7]+ -1e3+ -4e3+ -8e3+ -1e11).replace(/[018]/g,s)},o=function(e,t){return Math.floor(Math.random()*(t-e)+e)},u=function(e){typeof console!="undefined"&&typeof console.log!="undefined"&&console.log(e)},a=function(e){switch(e){case"he":case"ar":return!0;default:return!1}},f=function(e,t){if(!e||e<0)return 0;switch(t){case"h":return e*60*60*1e3;case"m":return e*60*1e3;case"s":return e*1e3;default:return e}},l=function(){try{return typeof localStorage!="undefined"}catch(e){return!1}};return{getHostFromUrl:e,extractUrlParam:t,parseBoolFromStorage:n,compareVersions:i,intervalExpired:r,getUUID:s,randomInt:o,logString:u,isRTL:a,convertToMillis:f,isLocalStorageAvailable:l}}),define("fallback",[],function(){var e={Status:"succeeded",Data:{interval:240,stamp:"0_0",isTest:!1,isWelcomeExperienceEnabledByDefault:!0,HadPG:!1,newAppsExperience:!1,UserCountryCode:"US",tracking:{ga:!0,db:!0},services:[{name:"configuration",url:"http://clientservice.mam.conduit-services.com/configuration?ctid=EBTOOLBARID&stamp=0_0&country=Unknown&browser=EBBROWSER&browserversion=EBBROWSERVERSION",interval:240},{name:"appsData",url:"http://clientservice.mam.conduit-services.com/appsdata?ctid=EBTOOLBARID&stamp=0_0&country=Unknown&browser=EBBROWSER&browserversion=EBBROWSERVERSION&local=EBLOCALE",interval:240},{name:"localization",url:"http://localizationservice.mam.conduit.com/getproducttranslation?p=mam&l=EBLOCALE",interval:1440},{name:"usage",url:"http://mam-usage.conduit-data.com",interval:240},{name:"login",url:"http://mam-alive-msg.conduit-data.com",interval:240},{name:"setupApi",url:"http://c.setupapi.toolbar.conduit-services.com/Properties/json/EBTOOLBARID/CC/US",interval:5}]}},t={apps:[{id:"PriceGong",url:"http://pricegong.conduitapps.com/MAM/v1/html_comp.html",optionsDialog:{displayName:"PriceGong",appDesc:"Your online shopping assistant. Use PriceGong to find the best online deals and get online coupons just when you need it.",privacyPolicyUrl:"http://www.pricegong.com/PrivacyPolicy.aspx",termsOfUseUrl:"http://www.pricegong.com/TermsofUse.aspx"},compatibility:[{platform:"IE_TB",maxVersion:"0.0.0.0"}],HiddenApp:!1,EnabledInHttps:!1},{id:"CouponBuddy",url:"http://www.socialgrowthtechnologies.com/couponbuddy_v003/index.php?ctid=EBTOOLBARID",optionsDialog:{displayName:"CouponBuddy",appDesc:"Coupon Buddy saves you money by serving you the best coupons and deals at thousands of the largest online merchants. Coupon Buddy recognizes where you are browsing and alerts you of the best deals right on the site you are visiting.",privacyPolicyUrl:"http://cbapp.com/privacypolicy/",termsOfUseUrl:"http://cbapp.com/privacypolicy/"},HiddenApp:!1,EnabledInHttps:!1}]},n={settingsEnable:{Text:"Enable"},settingsSave:{Text:"Save"},settingsCancel:{Text:"Cancel"},settingsCouponBuddyName:{Text:"Coupon Buddy"},settingsCouponBuddyDescription:{Text:"Coupon Buddy saves you money by serving you the best coupons and deals at thousands of the largest online merchants. Coupon Buddy recognizes where you are browsing and alerts you of the best deals right on the site you are visiting."},settingsPrivacyPolicy:{Text:"Privacy Policy"},settingsTermsOfUse:{Text:"Terms of Use"},settingsPriceGongName:{Text:"Price Gong"},settingsPriceGongDescription:{Text:"your online shopping assistant. Use PriceGong to find the best online deals and get online coupons just when you need it."},gadgetDescriptionPrimary:{Text:"Value Apps enriches your web experience by offering you great deals, coupons, related content and much more."},gadgetDescriptionSecondary:{Text:"Value Apps may require use of your personal information, including your Internet Protocol address, the webpages you visit and their content."},gadgetEnable:{Text:"Try it now"},gadgetNoThanks:{Text:"Customize"},gadgetTermsText:{Text:'By clicking "Try it now", you agree to the access, collection and usage of your information by Value Apps in accordance with the {{{termsAndPrivacyPolicyHandler}}}. See our {{{contentPolicyHandler}}} for more information.'},gadgetTermsAndPrivacyPolicy:{Text:"Terms & Privacy Policies"},gadgetContentPolicy:{Text:"Content Policy"},settingsEnabled:{Text:"Enabled"},newapptext:{Text:"[App name] was added to Value Apps service"},newapplearnmore:{Text:"Learn more"},newAppClickHere:{Text:"click here"},newAppMoreInfo:{Text:"For more information on privacy policy {{{privacyPolicyHandler}}}"},newGadgetTermsText:{Text:'By clicking "OK", you agree to the access, collection and usage of your information by Value Apps in accordance with the {{{termsAndPrivacyPolicyHandler}}}.'},gadgetDescriptionPrimaryMore:{Text:"Value Apps selects the apps that bring you the best daily offers based on your browsing information."},dialogOK:{Text:"OK"},settingsDialogTitle:{Text:"Are you sure you want to cancel Value Apps?"}},r={configuration:[{id:"CouponBuddy",criterias:[{criteriaId:"afaef6f3-bb55-461e-a477-83fe33697497",domains:["*"],domainsException:[""]}]},{id:"PriceGong",criterias:[{criteriaId:"8b0e1e23-108f-4fb2-aa6e-8ea51fc09964",domains:["*"],domainsException:[""]}]}],Status:"succeeded"},i=function(e){var t=this[e];return t.lastUpdateTime=(new Date).getTime(),t};return{settings:e,appsData:t,configuration:r,localization:n,getServiceDefaults:i}}),define("mamLib",["mamApi","utils","fallback"],function(e,t,n){var r=e.getInfo(),i="1.10.4.0",s=function(n){var r=' alertMessage("'+n+'"); ';$.browser.webkit&&(r='(function () {var b = document.getElementsByTagName("body")[0];var t = "'+encodeURIComponent(r)+'";'+'var s = document.createElement("script");'+'s.type="text/javascript";'+"s.innerHTML = decodeURIComponent(t);"+"b.appendChild(s);"+"}());"),e.jsInjection(r)},o=function(){var e=document.location.toString().split("#")[0];return e.substring(0,e.lastIndexOf("/"))+"/"}(),u=function(){var e="",t;try{e=r.general.toolbarVersion}catch(n){}return t=e.split("."),t.length>0&&t[0]>=10}(),a=function(){var e;switch(r.general.browser.toLowerCase()){case"firefox":e="FF";break;case"chrome":e="CH";break;case"ie":e="IE";break;default:e="SF"}return{type:e,version:r.general.browserVersion}}(),f=function(){return{type:r.context.host==="Extension"?"EXT":u?"SB":"TB",version:r.general.toolbarVersion,locale:function(){var e;return $.browser.msie?e=navigator.userLanguage:e=navigator.language,e.length>0?e.substring(0,2):r.general.toolbarLocale||"en"}()}}(),l={MAM_MODE:{OFF_LINE:"offline",ON_LINE:"online"},OFFLINE_SERVICES_BLACKLIST:{configuration:!0,appsData:!0},APPSTATE:{ON:"on",OFF:"off"},MESSAGES:{MAM_APPROVED:"mamApproved",SETTINGS_UPDATE:"settingsUpdate",REQUEST_SETTINGS:"requestSettings",OPEN_DELTA:"openDelta",SEND_USAGE:"sendUsage",CLOSE_WELCOME_GADGET:"closeWelcomeGadget",REPORT_APPS_STATE:"appsState",ADD_APP_TEST:"addProviderAppTest",RESET_MAM:"resetMAM",CLEAR_BADGE:"clearBadge"},ALIASES:{EBTOOLBARID:e.getToolbarId(),EBBROWSER:a.type,EBBROWSERVERSION:a.version,EBLOCALE:f.locale},MAM_EVENTS:{OPEN_WHATS_THIS:"openWhatsThis",JS_INJECTION:"JSInjection"},PRICEGONG_APP_ID:"PriceGong",PRICEGONG_WEBAPP_ID:"1ec55dac-8dca-406b-9697-5d68893c1c0c",SETTINGS_PAGE_APP_ID_PARAM_NAME:"appid",SETTINGS_PAGE_CTID_PARAM_NAME:"ctid",SETTINGS_PAGE_BACK_PARAM_NAME:"back",PRICEGONG_HANDLED_GLOBALKEYS_VERSION:"10.14.40.128",USAGE_FALLBACK_URL:"http://mam-usage.conduit-data.com/",APPS_APPROVED_FOR_HTTPS:["app13","Search_Ads_Plus","Search_Ads_Plus1","Search_Ads_Plus2","Search_Ads_Plus3","Search_Ads_Plus4"],ERROR_CATEGORY:"Error",FIRST_FAILURE:"FirstTimeFailure",UPDATE_FAILURE:"UpdateFailure",USAGE_LOG:"mam_usage_log",ERROR_LOG:"mam_error_log",CRITERIA_SUFFIX_TO_FORBID:"Exception",FLAVORS:{FREEGO:"fg",STANDALONE:"sa",TOOLBAR:"tb"},MAIN_DIALOG:{OK:"OK",CANCEL_SETTINGS:"CANCEL_SETTINGS",OPEN_SETTINGS_DIALOG:"OPEN_SETTINGS_DIALOG",CUSTOMIZE:"CUSTOMIZE",SAVE:"SAVE",CLOSE:"CLOSE",OPEN_LINK:"OPEN_LINK",SEND_USAGE:"SEND_USAGE",MODE:{FIRST_TIME:"0",NORMAL:"1"},SIZE:{HEIGHT:315,WIDTH:510}}},c={settings:"mam_gk_settings"+i,configuration:"mam_gk_configuration",appsData:"mam_gk_appsData",localization:"mam_gk_localization",login:"mam_gk_login",usage:"mam_gk_usage",dialogInteracted:"mam_gk_user_approval_interacted",mamPreapprovedByInstaller:"mam_gk_installer_preapproved",firstTime:"mam_gk_first_time",knownApps:"mam_gk_knownApps",userAppsSelection:"mam_gk_user_apps_selection",mamMsgForGadget:"mam_msg_for_gadget"+l.ALIASES.EBTOOLBARID.toLowerCase(),mamMsgForApp:"mam_msg_for_app"+l.ALIASES.EBTOOLBARID.toLowerCase(),mamTpiMsg:"mam_msg_key_tpi"+l.ALIASES.EBTOOLBARID.toLowerCase(),translationData:"mam_gk_translationData",userId:"mam_gk_userId",lastLoginTime:"mam_gk_lastLoginTime",lastAppStateReport:"mam_gk_appStateReportTime",gadgetOpen:"mam_gk_gadgetOpen",appsDefaultEnabled:"mam_gk_appsDefaultEnabled",showWelcome:"mam_gk_showWelcomeGadget",currentVersion:"mam_gk_currentVersion",controllerId:"mam_gk_controllerId",lastSettingsOpen:"mam_gk_lastSettingsOpen",pgUnloadedOnce:"mam_gk_pgUnloadedOnce",welcomeExperienceDecision:"mam_gk_welcomeExperienceDecision",mamMode:"mam_gk_mode",storageExistenceFlag:"mam_gk_checkStorage",currentBadgeValue:"mam_gk_currentBadgeValue",newApps:"mam_gk_newApps",migratedFromLocalStorage:"mam_gk_migrated_from_ls",migratedFromLocalStorageToLocalStorage:"mam_gk_migrated_from_ls_to_ls",mamEnabled:"mam_gk_mamEnabled",calledSetupService:"mam_gk_calledSetupService",existingUsersRecoveryDone:"mam_gk_existingUsersRecoveryDone",newWelcomeExperience:"mam_gk_new_welcome_experience",welcomeDialogMode:"mam_gk_welcomeDialogMode"},h=function(t){var n=$.browser.webkit&&!u&&f.type!=="EXT"?localStorage.getItem(t):e.retrieveGlobalKey(t);return n===""?null:n},p=function(t,n,r){if(r&&h(t)!==null)return;$.browser.webkit&&!u&&f.type!=="EXT"?localStorage.setItem(t,n):e.storeGlobalKey(t,n)},d=function(t){$.browser.webkit&&!u&&f.type!=="EXT"?localStorage.removeItem(t):e.deleteGlobalKey(t)},v=function(){var e=h(c.settings),t;try{t=JSON.parse(e)}catch(n){t=null}return t},m=v(),g="http://www.conduit.com/Privacy/content-policy.aspx",y={},b=function(e){var t=v(),n;if(!t||!t.Data)return null;t=t.Data;for(n=0;t&&t.services&&n<t.services.length;n++)if(t.services[n].name===e)return t.services[n];return null},w=function(){var e={},t;for(t in y)y.hasOwnProperty(t)&&(e[t]=y[t].appState());p(c.userAppsSelection,JSON.stringify(e))},E=function(){var e=l.ALIASES.EBTOOLBARID,t=v();return t.Data.isTest&&(e+="~"+t.Data.stamp),e},S=function(e){return(e.ga==="True"||e.ga===!0?"1":"0")+(e.db==="True"||e.db===!0?"1":"0")},x=function(e,t){var n=function(e,t){return e.indexOf("?")>-1?e+"&"+t:e+"?"+t},r=e.toString(),i,s;return t==="app"?(i=E(),r=r.replace(/EBTOOLBARID/g,i),r.indexOf(l.SETTINGS_PAGE_CTID_PARAM_NAME)===-1&&(r=n(r,l.SETTINGS_PAGE_CTID_PARAM_NAME+"="+i)),r=n(r,"ismanaged=true"),f.type==="EXT"&&a.type==="CH"&&(r+="#mam_app")):(r=r.replace(/EBTOOLBARID/g,l.ALIASES.EBTOOLBARID),r=r.replace(/EBBROWSERVERSION/g,l.ALIASES.EBBROWSERVERSION),r=r.replace(/EBBROWSER/g,l.ALIASES.EBBROWSER),r=r.replace(/EBLOCALE/g,l.ALIASES.EBLOCALE),s=v(),r=r.replace(/EBSTAMP/g,s&&s.Data.stamp?s.Data.stamp:""),r=r.replace(/TRACKINGPLACEHOLDER/g,s&&s.Data&&s.Data.tracking?S(s.Data.tracking):"")),r},T=function(e){var t;if(e.webAppId&&e.webAppId===l.PRICEGONG_WEBAPP_ID)return y[l.PRICEGONG_APP_ID];if(!e.windowName)return"";for(t in y)if(y.hasOwnProperty(t)&&y[t].frameName===e.windowName)return t;return""},N=function(n,r){var i="?"+l.SETTINGS_PAGE_CTID_PARAM_NAME+"="+e.getToolbarId(),s=$.browser.msie?e.navigateInMainFrame:e.navigateInNewTab,o,u,a=function(e){p(c.lastSettingsOpen,JSON.stringify({settingsPageFullUrl:e,lastTime:(new Date).getTime()}))};n&&(i+="&"+l.SETTINGS_PAGE_APP_ID_PARAM_NAME+"="+n),r&&(i+="&"+l.SETTINGS_PAGE_BACK_PARAM_NAME+"="+r),o=I+i,u=h(c.lastSettingsOpen);if(!u)a(o);else{u=JSON.parse(u);if(u.settingsPageFullUrl===o&&!t.intervalExpired(parseInt(u.lastTime,10),400))return;a(o)}s(o)},C=function(e,t,n){return JSON.stringify({topic:e,data:t||"",targetTab:n})},k=function(e){return e.toLowerCase().indexOf(I.toLowerCase())!==-1},L=function(e){return e===g||k(e)},A=function(e){var t=h(e),n;try{n=JSON.parse(t)}catch(r){n=null}return n},O=function(){var e=h(c.userAppsSelection),t;try{t=JSON.parse(e)}catch(n){t=null}return t}(),M={settings:"http://clientservice.mam.conduit-services.com/settings?ctid=EBTOOLBARID&stamp=EBSTAMP&browser=EBBROWSER&browserversion=EBBROWSERVERSION&l=EBLOCALE&tracking=TRACKINGPLACEHOLDER&v=2"},_=function(){try{var e=h(c.userId),n=t.isLocalStorageAvailable();return e?n&&(localStorage.getItem(c.userId)||localStorage.setItem(c.userId,e)):(n&&(e=localStorage.getItem(c.userId)),e||(e=t.getUUID(),n&&localStorage.setItem(c.userId,e)),p(c.userId,e)),e}catch(r){return""}},D=function(){var t=_(),n=e.getInfo(),r=n&&n.context&&n.context.host?n.context.host:null,s=n&&n.general&&n.general.toolbarVersion?n.general.toolbarVersion:e.getVersion()||null,o=e.getToolbarId()||null,u=n&&n.general&&n.general.OS?n.general.OS:null,a=n&&n.general&&n.general.browser?n.general.browser:null,f=n&&n.general&&n.general.browserVersion?n.general.browserVersion:null;return{userId:t,ctid:o,host:{type:r,version:s},os:u,version:i,browser:{type:a,version:f}}},P=function(){var t=function(t,n,r){var i=$.Deferred(),s=[];return s.push(function(e){var t;try{t=JSON.parse(e),t.Status==="failed"?i.reject(t):i.resolve(t)}catch(n){i.reject(e)}}),s.push(n.toUpperCase()),s.push(t),r&&(typeof r=="object"&&(r=JSON.stringify(r)),s.push(r)),e.crossDomainHttpRequest.apply(null,s),i.promise()},n=function(e){var t=$.Deferred();return $.when($.getJSON(e)).done(function(e){try{!e||e.Status==="failed"?t.reject(e):(e.lastUpdateTime=(new Date).getTime(),t.resolve(e))}catch(n){t.reject(e)}}).fail(function(e){t.reject(e)}),t.promise()},r=function(e,r){return $.browser.msie&&parseInt($.browser.version,10)<=9||r?t(e,"GET"):n(e)},i=function(e,n){return $.browser.msie&&parseInt($.browser.version,10)<=9?t(e,"POST",n):$.post(e,JSON.stringify(n))};return{getJson:r,post:i}}(),H=function(){var t=$.Deferred(),n,r=setInterval(function(){var i=e.getInfo();try{n=i.general.toolbarVersion,clearInterval(r),t.resolve()}catch(s){}},500);return t.promise()},B=function(){var n=$.Deferred();return u&&t.compareVersions(e.getInfo().general.toolbarVersion,l.PRICEGONG_HANDLED_GLOBALKEYS_VERSION)!==-1?e.onToolbarReady(function(){n.resolve()}):n.resolve(),n.promise()},j=function(){if($.browser.webkit&&u){var e=document.getElementById("pluginObj");return!!e&&typeof e.getKey=="function"}if($.browser.msie){var n,r=t.getUUID();p(c.storageExistenceFlag,r),n=h(c.storageExistenceFlag);if(r!==n)return!1}return!0},F=r.context.host=="Extension"?l.FLAVORS.STANDALONE:l.FLAVORS.TOOLBAR,I=function(){switch(F){case l.FLAVORS.FREEGO:return o+"freego-settings.html";case l.FLAVORS.STANDALONE:return o+"settings.html";case l.FLAVORS.TOOLBAR:default:return o+"settings.html"}}(),q=function(e){var t=JSON.parse(h(c.localization));return t[e]&&t[e].Text?t[e].Text:(t=n.getServiceDefaults("localization"),t[e]&&t[e].Text?t[e].Text:e)};return $.browser.chrome=/chrome/.test(navigator.userAgent.toLowerCase()),{version:i,browser:a,platform:f,APP_PATH:o,CONSTS:l,keys:c,settings:m,getSettings:v,getServiceData:A,knownApps:y,userAppsSelection:O,services:M,settingsPageUrl:I,contentPolicyUrl:g,utils:{getKey:h,setKey:p,removeKey:d,getService:b,storeUserAppsSelection:w,formatUrl:x,getAppIdForMAMEvent:T,openSettingsPage:N,createMessage:C,getCTIDForApp:E,isSpecialPage:L,waitForPlatform:H,waitForToolbar:B,isToolbarAlive:j,getString:q},hostInfo:{isSmartBar:u,toolbarVersion:r.general.toolbarVersion},getMamUserId:_,createUsagebject:D,http:P,flavor:F,messageToManageAppsPage:s}}),define("usage",["mamLib"],function(e){var t=function(t){var n=e.createUsagebject();n.event_split=e.CONSTS.ERROR_LOG,r(n,t)},n=function(t){var n=e.createUsagebject();n.event_split=e.CONSTS.USAGE_LOG,r(n,t)},r=function(t,n){var r=e.settings||{Data:{tracking:{ga:!1,db:!0},services:{filter:function(){}},stamp:null}},i=r.Data.tracking,s=r.Data.services.filter(function(e){return e.name==="usage"}),o=r.Data.stamp,u,a,f=["_trackEvent",n.category,n.action||"",n.label||""];!s||!s.length||!s[0].url?u=e.CONSTS.USAGE_FALLBACK_URL:u=s[0].url,_gaq&&(i.ga===!0||i.ga==="True")&&(typeof n.value!="undefined"&&f.push(parseInt(n.value,10)),_gaq.push(f));if(!i.db)return{};typeof n.category!="undefined"&&(t.eventType=n.category),typeof n.action!="undefined"&&(t.action=n.action),typeof n.label!="undefined"&&(t.label=n.label),typeof n.value!="undefined"&&(t.value=n.value);if(typeof n.jsonObj!="undefined")for(a in n.jsonObj)n.jsonObj.hasOwnProperty(a)&&(t[a]=n.jsonObj[a]);return t.testId=o,e.http.post(u,t)};return{sendUsage:n,sendError:t}}),define("services",["mamApi","mamLib","utils","usage","fallback"],function(e,t,n,r,i){var s=function(){var e=t.getServiceData(t.keys.configuration)||[],n=t.getServiceData(t.keys.appsData)||[],r,i,s,o,u,a;e.configuration&&(e=e.configuration),n.apps&&(n=n.apps);for(s=0,u=e.length;s<u;s++){r=e[s].id,i=!1;for(o=0,a=n.length;o<a;o++)if(r===n[o].id){i=!0;break}if(!i)break}return i},o=function(e){var n;return e==="settings"?t.settings&&t.settings.Data&&t.settings.Data.interval?t.settings.Data.interval:null:(e==="appsData"&&(e="configuration"),n=t.utils.getService(e),n&&n.interval?n.interval:null)},u=function(e){var n=e==="settings"?t.services.settings:t.utils.getService(e).url;return t.utils.formatUrl(n,"service")},a=function(){if(!t.utils.isToolbarAlive())return;var e=t.utils.getKey(t.keys.lastAppStateReport),i=o("usage"),s={},u=[],f;e&&(e=parseInt(e,10));if(!n.intervalExpired(e,i*60*1e3)){setTimeout(a,i*60*1e3);return}for(f in t.knownApps)t.knownApps.hasOwnProperty(f)&&u.push({appId:f,isEnabled:t.knownApps[f].appState()});s.appsState=u,$.when(r.sendUsage({category:t.CONSTS.MESSAGES.REPORT_APPS_STATE,jsonObj:s})).always(function(){var e=(new Date).getTime().toString();t.utils.setKey(t.keys.lastAppStateReport,e),setTimeout(a,i*60*1e3)})},f=function(){if(!t.utils.isToolbarAlive())return;var e=t.utils.getKey(t.keys.lastLoginTime),r=e==null,i=u("login"),s=o("login"),a=t.getSettings(),l;e&&(e=parseInt(e,10));if(!n.intervalExpired(e,s*60*1e3)){setTimeout(f,s*60*1e3);return}l=t.createUsagebject(),l.isTest=a.Data.isTest,l.stamp=a.Data.stamp,l.firstLogin=r,$.when(t.http.post(i,l)).always(function(){var e=(new Date).getTime().toString();t.utils.setKey(t.keys.lastLoginTime,e),setTimeout(f,s*60*1e3)})},l=function(e,r,i,s){if(!t.utils.isToolbarAlive())return;var a=$.Deferred(),f=o(e),c=u(e),h=t.getServiceData(t.keys[e]),p=h&&h.lastUpdateTime?h.lastUpdateTime:null;return h&&(t[e]=h),t.CONSTS.OFFLINE_SERVICES_BLACKLIST[e]&&t.utils.getKey(t.keys.mamMode)==t.CONSTS.MAM_MODE.OFF_LINE?(a.resolve(t[e]),a.promise()):(t[e]&&!s&&!n.intervalExpired(p,f*60*1e3)?(setTimeout(function(){l(e,r,i)},f*60*1e3),a.resolve(t[e])):$.when(t.http.getJson(c)).done(function(e){$.when(r(e)).done(function(e){a.resolve(e)}).fail(function(){a.reject()})}).fail(function(){return function(e){$.when(i(e)).done(function(e){a.resolve(e)}).fail(function(){a.reject()})}}(c)).always(function(){setTimeout(function(){l(e,r,i)},f*60*1e3)}),a.promise())},c=function(){var e=$.Deferred(),r="setupApi",i=n.parseBoolFromStorage(t.utils.getKey(t.keys.mamPreapprovedByInstaller)),s=t.utils.getKey(t.keys.mamEnabled)!==null,o=t.utils.getKey(t.keys.calledSetupService);if(o||i===!0||s||!t.utils.getService(r)){e.resolve();return}t.utils.setKey(t.keys.calledSetupService,"1");var a=u(r);return $.when(t.http.getJson(a)).done(function(n){if(n&&n._MAM_ENABLED_){var r=n._MAM_ENABLED_.toLowerCase()==="true";t.utils.setKey(t.keys.mamEnabled,r.toString())}e.resolve()}).fail(function(t){e.resolve()}),e.promise()},h=function(){var e=$.Deferred();return $.when(l("settings",g,y)).fail(function(){e.reject(e.promise())}).done(function(){$.when(l("configuration",b,w),l("localization",x,T),l("appsData",E,S),c()).fail(function(){e.reject(e.promise())}).done(function(){s()?e.resolve(e.promise()):$.when(l("appsData",E,S)).fail(function(){e.reject(e.promise())}).done(function(){e.resolve(e.promise())})})}),e.promise()},p=function(e){var n,r,i,s=[],o=t.getSettings();if(!o)return s;var u=o.Data.services;if(e.Data.stamp!==o.Data.stamp)return s.push("settings"),s;for(n=0;n<e.Data.services.length;n++){i=e.Data.services[n].name;for(r=0;r<u.length;r++)if(u[r].name===i){e.Data.services[n].url!==u[r].url&&s.push(i);break}}return s},d=function(e){var t,n;switch(e){case"appsData":t=E,n=S;break;case"configuration":t=b,n=w;break;case"localization":t=x,n=T;break;default:t=function(){},n=function(){}}return{success:t,failure:n}},v=function(e,n){var s={};n&&typeof n.Status=="string"&&n.Status==="failed"&&(s={error:{status:n.Status,message:n.Reason}});if(!t[e]){var o=i.getServiceDefaults(e);t[e]=o,r.sendError({category:t.CONSTS.ERROR_CATEGORY,action:"get_"+e,label:t.CONSTS.FIRST_FAILURE,value:n&&n.status||0,jsonObj:s})}else r.sendError({category:t.CONSTS.ERROR_CATEGORY,action:"get_"+e,label:t.CONSTS.UPDATE_FAILURE,value:n&&n.status||0,jsonObj:s});t[e].lastUpdateTime=(new Date).getTime(),t.utils.setKey(t.keys[e],JSON.stringify(t[e]))},m=function(e,n,i){var s={};n&&typeof n.Status=="string"&&n.Status==="failed"&&(s={error:{status:n.Status,message:n.Reason}}),s.error||(s.error={}),s.error.clientException=e.message,r.sendError({category:t.CONSTS.ERROR_CATEGORY,action:"get_"+i,label:t.CONSTS.UPDATE_FAILURE,value:s.status||0,jsonObj:s})},g=function(e){var r=$.Deferred(),i=p(e),s,o;e.lastUpdateTime=(new Date).getTime(),t.settings=e,t.utils.setKey(t.keys.settings,JSON.stringify(e));if(i.length>0){var u=$.inArray("settings",i);if(u!==-1)l("configuration",b,w,!0),l("appsData",E,S,!0);else for(s=0;s<i.length;s++){o=i[s];switch(o){case"appsData":case"configuration":case"localization":n.logString(o+" URL changed"),l(o,d(o).success,d(o).failure,!0);break;default:}}}return r.resolve(e),r},y=function(e){var n=$.Deferred(),r="settings";try{v(r,e),n.resolve(t[r])}catch(i){m(i,e,r),n.reject()}return n},b=function(e){var n=$.Deferred(),r="configuration";return e.lastUpdateTime=(new Date).getTime(),t[r]=e,t.utils.setKey(t.keys[r],JSON.stringify(e)),n.resolve(e),n},w=function(e){var n=$.Deferred(),r="configuration";try{v(r,e),n.resolve(t[r])}catch(i){m(i,e,r),n.reject()}return n},E=function(e){var n=$.Deferred(),r="appsData",i=t.utils.getKey(t.keys[r]),s=t.utils.getKey(t.keys.newApps),o=0,u=[],a={},f=(new Date).getTime().toString();if(i){try{var l=JSON.parse(i).apps}catch(c){l={}}for(o=0;o<l.length;o++)a[l[o].id]=!0;for(o=0;o<e.apps.length;o++)a[e.apps[o].id]||u.push({id:e.apps[o].id,name:e.apps[o].optionsDialog.displayName,description:e.apps[o].optionsDialog.appDesc,addedAt:f});u.length>0&&(s&&(s=JSON.parse(s),u=u.concat(s)),t.utils.setKey(t.keys.newApps,JSON.stringify(u)))}return e.lastUpdateTime=(new Date).getTime(),t[r]=e,t.utils.setKey(t.keys[r],JSON.stringify(e)),n.resolve(e),n.promise()},S=function(e){var n=$.Deferred(),r="appsData";try{v(r,e),!s(),n.resolve(t[r])}catch(i){m(i,e,r),n.reject()}return n},x=function(e){var n=$.Deferred(),r="localization";return e.lastUpdateTime=(new Date).getTime(),t[r]=e,t.utils.setKey(t.keys[r],JSON.stringify(e)),n.resolve(e),n},T=function(e){var n=$.Deferred(),r="localization";try{v(r,e),n.resolve(t[r])}catch(i){m(i,e,r),n.reject()}return n};return{checkServices:h,login:f,reportAppsState:a}}),define("App",["mamApi","mamLib","utils"],function(e,t,n){function r(e){this.iframe=null,this.frameName=null,this.loadState=0,this.isHidden=e.isHidden,this.name=e.name,this.url=e.url,this.optionsDialog=e.optionsDialog,this.isNewApp=e.isNewApp,this.appStateKey="mam_gk_appState_"+e.name,this.cbQueue=[]}return r.prototype={init:function(n){typeof n!="function"&&(n=function(){});if(this.loadState===2){n(this);return}this.cbQueue.push(n);if(this.loadState===1)return;this.loadState=1;var r=this;e.createNestedContext(r.name,function(e){e=e||r.name,r.frameName=e;var n=document.createElement("iframe");n.setAttribute("id",e),n.setAttribute("name",e),n.setAttribute("class","appframe"),n.setAttribute("src",t.utils.formatUrl(r.url,"app")),n.setAttribute("scrolling","no"),n.setAttribute("allowtransparency","true"),n.setAttribute("frameborder","0"),n.setAttribute("height","22"),document.body.appendChild(n),r.iframe=$(n),$(n).on("load",function(){var e;r.loadState=2;for(e=0;e<r.cbQueue.length;e++)r.cbQueue[e](r);r.cbQueue=[]})})},triggerEvent:function(t,r){if(!this.appState())return;n.logString("about to call executeScriptInFrame for "+this.name+" for "+t+" with url: "+r.url),e.executeScriptInFrame(this.frameName,this.formatEvent(t,r),function(){})},appState:function(e){if(typeof e=="undefined"){var n=t.utils.getKey(this.appStateKey);return!n||n===t.CONSTS.APPSTATE.ON}return t.utils.setKey(this.appStateKey,e?t.CONSTS.APPSTATE.ON:t.CONSTS.APPSTATE.OFF),!0},formatEvent:function(e,t){var n="var args = [];var eventData = "+JSON.stringify(t)+";for(var i in eventData){args.push(eventData[i])};if (typeof("+e+')==="function") {'+(e+".apply(this, args); }").replace('"undefined"',"undefined");return $.browser.webkit?'(function () {var b = document.getElementsByTagName("body")[0];var t = "'+encodeURIComponent(n)+'";'+'var s = document.createElement("script");'+'s.type="text/javascript";'+"s.innerHTML = decodeURIComponent(t);"+"b.appendChild(s);"+"})();":n}},r}),define("WebApp",["mamLib","mamApi","utils"],function(e,t,n){function i(t){this.loadState=0,this.cachedEvent=null,this.isHidden=t.isHidden,this.appid=e.CONSTS.PRICEGONG_WEBAPP_ID,this.name=t.name,this.appStateKey="mam_gk_appState_"+t.name,this.url=t.url,this.optionsDialog=t.optionsDialog,this.isNewApp=t.isNewApp,this.cbQueue=[]}var r={EBNavigateComplete:"tabs.onNavigateComplete",EBDocumentComplete:"tabs.onDocumentComplete"};return i.prototype={init:function(n){var r=this;typeof n!="function"&&(n=function(){});if(r.loadState===2){n(r);return}r.cbQueue.push(n);if(r.loadState===1)return;return this.loadState=1,t.addWebApp(r.appid,{blockEvents:!1,visible:!1,ctid:e.utils.getCTIDForApp(),extraData:"MAM"},function(){setTimeout(function(){var e;r.loadState=2;for(e=0;e<r.cbQueue.length;e++)r.cbQueue[e](r);r.cbQueue=[]},3e3)}),this},triggerEvent:function(e,r){return},appState:function(t){if(typeof t=="undefined"){var n=e.utils.getKey(this.appStateKey);return!n||n===e.CONSTS.APPSTATE.ON}return e.utils.setKey(this.appStateKey,t?e.CONSTS.APPSTATE.ON:e.CONSTS.APPSTATE.OFF),!0},formatEvent:function(e,t){return{eventType:r[e],eventData:t}}},i}),define("domains",["mamApi","utils"],function(e,t){var n=function(n){var r=!1,i,s=t.getHostFromUrl(e.getMainFrameUrl());if(!n||!n.length||n[0]==="*")return!0;if(n[0]==="-")return!1;for(i=0;i<n.length;i++){r=r||n[i].length>0&&s.match(n[i].toLowerCase().replace(/\*/g,"[a-zA-Z0-9.-_]*"));if(r)break}return r};return{name:"domains",test:n}}),define("DMP",["mamLib","domains"],function(e,t){function i(e){return"modules/criterias/"+e}function s(){var s=e.getServiceData(e.keys.configuration)||[],o,u,a,f=[],l=$.Deferred(),c,h,p;s.configuration&&(s=s.configuration);if(n)return l.resolve();for(c=0;c<s.length;c++){o=s[c].criterias;for(h=0;h<o.length;h++){u=o[h];for(a in u)u.hasOwnProperty(a)&&a!=="criteriaId"&&(p=i(a),f.indexOf(p)===-1&&f.push(p))}}return r.domains=t,n=!0,l.resolve(),l.promise()}function o(e,t){var n;for(n=0;n<e.length;n++)if(e[n].id===t)return e[n].criterias;return null}function u(e,t){return e.match(t+"$")==t}function a(t,n){var i=!1,s=!0,o,a,f,l;if(!t||!t.length)return n?!1:-1;for(o=0;o<t.length;o++){a=t[o],f=null,s=!0;for(f in a)a.hasOwnProperty(f)&&f!=="criteriaId"&&!u(f,"Exception")&&r[f]&&typeof r[f].test=="function"&&(l=f+e.CONSTS.CRITERIA_SUFFIX_TO_FORBID,a.hasOwnProperty(l)&&a[l]&&(s=s&&!r[f].test(a[l])),s=s&&r[f].test(a[f]));i=i||s;if(i)return a.criteriaId}return i}function f(){var t=$.Deferred();return $.when(s()).done(function(){var n=e.getSettings(),r=[],i=n.Data.isTest,s,u,f;if(!n){t.reject();return}f=e.getServiceData(e.keys.configuration)||[],f.configuration&&(f=f.configuration);for(s in e.knownApps)e.knownApps.hasOwnProperty(s)&&(u=a(o(f,s),i),u&&r.push({appId:s,criteriaId:u}));if(!r.length&&!i)for(s in e.knownApps)e.knownApps.hasOwnProperty(s)&&r.push({appId:s,criteriaId:-1});t.resolve(r)}),t.promise()}var n=!1,r={};return{run:f,initialized:n}}),define("mamView",["mamLib"],function(e){var t=function(){$(function(){$("#iconContainer").addClass("active").off("click").on("click",function(){require(["mamController"],function(t){if(e.flavor===e.CONSTS.FLAVORS.FREEGO)return;t.launchDialog()})})})},n=function(e){var t=$(".mam-badge");e?t.show():t.hide()},r=function(e){$(".mam-badge").text(e),n(e)};return{bindEvents:t,updateBadgeNumber:r,showBadge:n}}),define("polyfill",[],function(){Array.prototype.filter||(Array.prototype.filter=function(e){var t=this.length,n=[],r=arguments[1],i,s;if(typeof e!="function")throw new TypeError;for(i=0;i<t;i++)this.hasOwnProperty(i)&&(s=this[i],e.call(r,s,i,this)&&n.push(s));return n}),Array.prototype.forEach||(Array.prototype.forEach=function(e){var t=arguments[1],n;if(typeof e!="function")throw new TypeError;for(n=0;n<this.length;n++)this.hasOwnProperty(n)&&e.call(t,this[n],n,this)}),String.prototype.format||(String.prototype.format=function(){var e=this,t,n;for(t=0;t<arguments.length;t++)n=new RegExp("\\{"+t+"\\}","gm"),e=e.replace(n,arguments[t]);return e}),Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i});var e=function(){try{return typeof Storage!="undefined"}catch(e){return!1}};e()&&Storage.prototype.setItem&&Storage.prototype.getItem&&(Storage.prototype._setItem=Storage.prototype.setItem,Storage.prototype.setItem=function(e,t,v){this._setItem((v ? '' : (GetToolbarId()+"."))+e,t)},Storage.prototype._getItem=Storage.prototype.getItem,Storage.prototype.getItem=function(e,v){return this._getItem((v ? '' : (GetToolbarId()+"."))+e)})}),define("pubsub",["mamApi","utils","mamLib","polyfill"],function(e,t,n){var r=!!$.browser.webkit&&n.platform.type!=="EXT",i="mam_gk_eventsCache",s=function(e){var t=JSON.parse(n.utils.getKey(i)||"{}");return t[e.uniqueId]?!0:(e.eventTriggerTime=(new Date).getTime(),t[e.uniqueId]=e,n.utils.setKey(i,JSON.stringify(t)),!1)},o=function(){var e=JSON.parse(n.utils.getKey(i)||"{}"),r;if(e){for(r in e)e.hasOwnProperty(r)&&t.intervalExpired(e[r],1e4)&&delete e[r];n.utils.setKey(i,JSON.stringify(e))}},u=function(e){if(typeof e=="string")try{e=JSON.parse(e)}catch(t){}return e},a=function(n,i,s){var o=JSON.stringify({topic:i,data:s||"",uniqueId:t.getUUID()});r?e.storeGlobalKey(n,o):e.sendMessage(n,o)},f=function(e,i,a){typeof i!="function"&&(i=function(){});var f=function(e,r){return function(i,f){var l=this,c=function(e){s(e)||(r.call(l,e),o())};i===e&&(f=u(f),a&&($.browser.webkit&&n.hostInfo&&n.hostInfo.isSmartBar===!1||n.platform.type==="EXT")?c(f):setTimeout(function(){c(f)},t.randomInt(50,600)))}.bind(this)},l=f.call(this,e,i);r&&!a?window.EBGlobalKeyChanged=function(t,n){var r;if(t!==e)return;try{r=JSON.parse(n);if(!r.topic)return}catch(i){}l(t,r)}.bind(this):conduit.messaging.onRequest.addNamedListener(e,l)};return{listen:f,sendMessage:a}}),define("upgrader",["mamLib","mamApi"],function(e,t){var n=function(n,r){var i=e.utils.getKey(n);i!==null&&!!i&&typeof i!="undefined"&&(t.deleteGlobalKey(n),e.utils.setKey(r||n,i.toString()))},r=function(n){t.deleteGlobalKey(n),e.utils.removeKey(n)},i=function(){e.utils.getKey("mam_gk_settings"+e.version)||(n("mam_gk_first_time"),n("mam_gk_first_time"),n("mam_gk_lastLoginTime"),n("mam_gk_user_apps_selection"),n("mam_gk_userId"),n("mam_CouponBuddy_appState","mam_gk_CouponBuddy_appState"),n("mam_PriceGong_appState","mam_gk_PriceGong_appState"),n("mam_gk_CouponBuddy_appState","mam_gk_appState_CouponBuddy"),n("mam_gk_PriceGong_appState","mam_gk_appState_PriceGong"),r("mam_gk_appsData"),r("mam_gk_configuration"),r("mam_gk_settings"))},s=function(){e.utils.setKey(e.keys.currentVersion,e.version.toString())},o=function(){if(e.browser.type==="CH"){var n,r,i=localStorage.getItem(e.keys.userId,!0);if(e.hostInfo.isSmartBar){var s=[],o=e.utils.getKey(e.keys.migratedFromLocalStorage),u=e.utils.getKey(e.keys.userId);if(!o&&i&&!u){for(var a=0;a<localStorage.length;a++)n=localStorage.key(a),n=n.substring(n.indexOf(".")+1),n.indexOf("mam_gk")==0&&(r=localStorage.getItem(n),s.push(n),t.storeGlobalKey(n,r));for(var f=0;f<s.length;f++)localStorage.removeItem(s[f]);e.utils.setKey(e.keys.migratedFromLocalStorage,"1")}}else{var o=e.utils.getKey(e.keys.migratedFromLocalStorageToLocalStorage);if(!o&&i){for(var a=0;a<localStorage.length;a++)n=localStorage.key(a),n.indexOf("mam_gk")==0&&(r=localStorage.getItem(n,!0),localStorage.setItem(n,r));e.utils.setKey(e.keys.migratedFromLocalStorageToLocalStorage,"1")}}}},u=function(){o(),i(),s()};return{upgradeVersion:u}}),define("rolloutHelper",["mamLib","mamApi","utils"],function(e,t,n){var r="PG_ENABLE",i=function(e){return e&&e.indexOf("false")===0&&(e="false"),!!n.parseBoolFromStorage(e)},s=function(){var e=document.getElementById("pluginObj"),i=window.name.split("___")[1],s=t.getToolbarId()+"."+r,o=!1,u,a;try{return a=e.getKey(i,s,o),u=JSON.parse(a),u.status===0&&(u.result=decodeURIComponent(u.result),a=e.decodeText("windows-1255","B",u.result)),n.logString("NPAPI result: "+a),JSON.parse(a)}catch(f){return{}}},o={exists:function(){return!!e.utils.getKey("cbfirsttime")},enabled:function(){return!e.utils.getKey("cb")||e.utils.getKey("cb")==="1"},removeOldKeys:function(){t.deleteGlobalKey("cb")}},u={exists:function(){var t,o,u,a;return $.browser.msie?!1:(t=e.getSettings(),$.browser.webkit&&e.hostInfo.isSmartBar&&n.compareVersions(e.hostInfo.toolbarVersion,e.CONSTS.PRICEGONG_HANDLED_GLOBALKEYS_VERSION)!==-1?(a=s(),o=a.status===0):o=i(e.utils.getKey(r)),u=t&&t.Data&&t.Data.HadPG,e.hostInfo.isSmartBar?u&&n.compareVersions(e.hostInfo.toolbarVersion,e.CONSTS.PRICEGONG_HANDLED_GLOBALKEYS_VERSION)===-1||o:o||u||!!e.utils.getKey("/9B5BA==9CJAG")||!!e.utils.getKey("/9B-0?3G>D"))},enabled:function(){var t;return $.browser.msie?!1:e.hostInfo.isSmartBar?n.compareVersions(e.hostInfo.toolbarVersion,e.CONSTS.PRICEGONG_HANDLED_GLOBALKEYS_VERSION)===-1?null:$.browser.webkit?(t=s(),t.status===0?t.result==="true":!1):i(e.utils.getKey(r)):i(e.utils.getKey(r))},removeOldKeys:function(){}};return{priceGong:u,couponBuddy:o}}),define("mamController",["mamApi","mamLib","services","App","WebApp","DMP","mamView","usage","utils","pubsub","upgrader","rolloutHelper"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=$.Deferred(),p=$.Deferred(),d=!1,v=!1,m=function(e){a.logString("Passing event - "+JSON.stringify(e)),$.when(s.run(),p.promise()).done(function(n){a.logString("got matching apps: "+n.length+" before "+e.type),n.forEach(function(n){var r=t.knownApps[n.appId],i=n.criteriaId;(r.appState())&&r.init(function(e,n,r){return function(){if(r.data.url&&r.data.url.indexOf("https://")===0&&t.CONSTS.APPS_APPROVED_FOR_HTTPS.indexOf(e.name)===-1)return;e.triggerEvent(r.type,r.data)}}(r,i,e))})})},g=function(n){var r,i,s,o="savelocation=0,openposition=offset:(0;28),closeonexternalclick=no,saveresizedsize=no,titlebar=no,resizable=no,vscroll=no,hscroll=no",a,f;n=n||{},typeof n.view=="undefined"&&(f=t.utils.getKey(t.keys.newApps)!==null&&JSON.parse(t.utils.getKey(t.keys.newApps)).length>0,n.view=f&&t.settings.Data.newAppsExperience?"newApp":"welcome");switch(n.view){case"welcome":if(t.platform.type==="EXT"){r="{0}mainDialog.html?ctid={1}".format(t.APP_PATH,t.CONSTS.ALIASES.EBTOOLBARID),u.sendUsage({category:"WelcomePage",action:"Impression"}),e.navigateInNewTab(r);return}t.utils.setKey(t.keys.gadgetOpen,"welcome"),i=t.CONSTS.MAIN_DIALOG.SIZE.WIDTH,s=t.CONSTS.MAIN_DIALOG.SIZE.HEIGHT,r="{0}mainDialog.html?v={1}&ctid={2}".format(t.APP_PATH,t.version,t.CONSTS.ALIASES.EBTOOLBARID);break;case"whats-this":i=660,s=130,r="{0}whats-this.html?v={1}&name={2}".format(t.APP_PATH,t.version,n.appName);break;case"newApp":t.utils.setKey(t.keys.gadgetOpen,"newApp"),i=340,s=160,r="{0}newApp.html?v={1}&ctid={2}".format(t.APP_PATH,t.version,t.CONSTS.ALIASES.EBTOOLBARID)}a=t.utils.getKey(t.keys.gadgetOpen),a&&n.view!==a&&e.closeFloatingWindow(),r&&e.launchGadget(r,i,s,o)},y=function(){var n=[],r,i={},s,o,u=t.settings.Data.isTest,a=t.getServiceData(t.keys.configuration),f=t.getServiceData(t.keys.localization),l,c=function(e){n.push({id:e,state:t.knownApps[e].appState(),texts:t.knownApps[e].optionsDialog})};for(r in t.knownApps)if(t.knownApps.hasOwnProperty(r)&&!t.knownApps[r].isHidden)if(u){for(l=0;l<a.configuration.length;l++)if(a.configuration[l].id===r){c(r);break}}else c(r);for(s in f)f.hasOwnProperty(s)&&s.substring(0,8)==="settings"&&(i[s]=f[s]);o='if(typeof (MAM) !== "undefined" && !window.renderSettingsDone) { MAM.Settings.localizationData = '+JSON.stringify(i)+";"+"MAM.Settings.render("+JSON.stringify(n)+', "'+t.CONSTS.ALIASES.EBLOCALE+'" );'+"MAM.Settings.sendWhatsThisUsage();"+"}",$.browser.webkit&&(o='(function () {var b = document.getElementsByTagName("body")[0];var t = "'+encodeURIComponent(o)+'";'+'var s = document.createElement("script");'+'s.type="text/javascript";'+"s.innerHTML = decodeURIComponent(t);"+"b.appendChild(s);"+"}());"),e.jsInjection(o)},b=function(t){if(!t)return;if(window.__mainFrameUrlFromWebPage){t(window.__mainFrameUrlFromWebPage,!0);return}window.__instanceID||(window.__instanceID=a.getUUID(),conduit.messaging.onRequest.addListener(function(n){try{var n=EBJSON.parse(n);n.instanceID==window.__instanceID&&(window.__mainFrameUrlFromWebPage=n.url,t(n.url,!0))}catch(r){t(e.getMainFrameUrl(),!0)}}));var n='EBCallBackMessageReceived(\'{"url":"\'+document.location.href.toString()+\'", "instanceID":"'+window.__instanceID+"\"}');";$.browser.webkit&&(n='(function () {var b = document.getElementsByTagName("body")[0];var t = "'+encodeURIComponent(n)+'";'+'var s = document.createElement("script");'+'s.type="text/javascript";'+"s.innerHTML = decodeURIComponent(t);"+"b.appendChild(s);"+"}());"),e.jsInjection(n)},w=function(e){var n={type:"EBDocumentComplete",data:{url:e.url,tabId:e.id,extraData:e.extraData}};if(t.platform.type==="EXT"||!$.browser.webkit||!v)v=!0,e.isSelfGenerated?b(function(e){n.data.url=e,h.resolve(n.data),m(n)}):(h.resolve(n.data),m(n))},E=function(e){window.mamNavCompleteMainFrameUrl=e.url;var n={type:"EBNavigateComplete",data:{url:e.url,tabId:e.id,postData:e.postData}};if(t.platform.type==="EXT"||!$.browser.webkit||!d)d=!0,e.isSelfGenerated?b(function(e){n.data.url=e,window.mamNavCompleteMainFrameUrl=e,m(n)}):m(n)},S=function(){$.browser.webkit&&t.platform.type!=="EXT"&&setTimeout(function(){var t={isSelfGenerated:!0,url:e.getMainFrameUrl(),id:null};E(t),setTimeout(function(){w(t)},300)},t.hostInfo.isSmartBar?4e3:1e3),conduit.tabs.onNavigateComplete.addListener(E),conduit.tabs.onDocumentComplete.addListener(w),window.EBTabChange=function(e){m({type:"EBTabChange",data:{url:e,tabId:0}})},window.EBMAMButtonClicked=function(){},window.mamOpenSettings=function(){t.utils.openSettingsPage(null,"whats-this")}},x=function(e){var n=t.utils.getKey(t.keys.newApps);n?(n=JSON.parse(n),A(n),t.utils.setKey(t.keys.currentBadgeValue,n.length.toString()),U(n.length.toString())):e=!0,e&&(o.showBadge(!1),t.utils.removeKey(t.keys.currentBadgeValue)),setTimeout(x,a.convertToMillis(6,"h"))},T=function(){conduit.mam.onVendorApiEvent.addListener(function(e){switch(e.mamEventName){case t.CONSTS.MAM_EVENTS.OPEN_WHATS_THIS:var n=t.utils.getAppIdForMAMEvent(e);$.browser.msie&&t.platform.type!=="EXT"?g({view:"whats-this",appName:n}):t.utils.openSettingsPage(n,"whats-this");break;case t.CONSTS.MAM_EVENTS.JS_INJECTION:break;default:}})},N=function(e){var n,r,i;if(e.length===0)return;for(i=0;i<e.length;i++)r=e[i],n=t.knownApps[r.id],n&&n.appState(r.state)},C=function(e){var n;for(n in t.knownApps)t.knownApps.hasOwnProperty(n)&&(t.knownApps[n].isHidden||t.knownApps[n].appState(!!e))},k=function(e){var n,r,i,s,o,u=!1;if(!e||e.length===0)return!0;n=t.browser.type+"_"+t.platform.type;for(r=0;r<e.length;r++)if(n===e[r].platform){n=e[r],u=!0;break}return u?(i=t.platform.version,s=e[r].minVersion?a.compareVersions(e[r].minVersion,i):0,o=e[r].maxVersion?a.compareVersions(i,e[r].maxVersion):0,s!==1&&o!==1):!0},L=function(){var e=t.getServiceData(t.keys.appsData)||[],n=t.settings.Data.newAppsExperience,s=t.utils.getKey(t.keys.newApps);if(!e||!e.apps)return;e.apps.forEach(function(e){var n;k(e.compatibility)&&(n={name:e.id,url:e.url,optionsDialog:e.optionsDialog,isHidden:e.isHidden},t.knownApps[e.id]=e.id===t.CONSTS.PRICEGONG_APP_ID&&t.hostInfo.isSmartBar?new i(n):new r(n))}),n&&s&&(s=JSON.parse(s),A(s),s.length>0&&t.utils.getKey(t.keys.firstTime)==="1"&&(t.utils.setKey(t.keys.currentBadgeValue,s.length.toString()),x()))},A=function(e){var n;for(n=0;n<e.length;n++)a.intervalExpired(parseInt(e[n].addedAt,10),a.convertToMillis(72,"h"))&&(u.sendUsage({category:"NewApp",action:"Disappear",label:"TimeIsUp",value:e[n].id}),e.splice(n,1));t.utils.setKey(t.keys.newApps,JSON.stringify(e))},O=function(e){switch(e.topic){case t.CONSTS.MESSAGES.MAM_APPROVED:t.utils.setKey(t.keys.dialogInteracted,"1"),C(!0);break;case t.CONSTS.MESSAGES.SETTINGS_UPDATE:t.utils.setKey(t.keys.dialogInteracted,"1"),N(e.data);break;case t.CONSTS.MESSAGES.REQUEST_SETTINGS:y();break;case t.CONSTS.MESSAGES.SEND_USAGE:u.sendUsage.apply(this,[e.data]);break;case t.CONSTS.MESSAGES.ADD_APP_TEST:M(e.data);break;case t.CONSTS.MESSAGES.RESET_MAM:_(e.data);break;case t.CONSTS.MESSAGES.CLEAR_BADGE:x(!0);break;default:}},M=function(e){t.utils.setKey(t.keys.mamMode,t.CONSTS.MAM_MODE.OFF_LINE);for(var n=0;n<e.length;n++)t.utils.setKey(t.keys[e[n].serviceName],JSON.stringify(e[n].serviceValue));t.knownApps=[],R(),t.messageToManageAppsPage("The app was added successfully")},_=function(e){t.utils.setKey(t.keys.mamMode,t.CONSTS.MAM_MODE.ON_LINE);for(var n=0;n<e.servicesNames.length;n++)t.utils.removeKey(t.keys[e.servicesNames[n]]);t.knownApps=[],R(),t.messageToManageAppsPage("MAM reset successfully")},D=function(){f.listen.call(this,t.keys.mamMsgForApp,O),f.listen.call(this,t.keys.mamTpiMsg,O,!0)},P=function(){var n=$.Deferred();return!t.hostInfo.isSmartBar||a.compareVersions(t.hostInfo.toolbarVersion,t.CONSTS.PRICEGONG_HANDLED_GLOBALKEYS_VERSION)!==-1&&a.parseBoolFromStorage(t.utils.getKey(t.keys.pgUnloadedOnce))===!0?n.resolve():e.removeWebApp(t.CONSTS.PRICEGONG_WEBAPP_ID,function(){a.logString("Removed PriceGong webapp!!!"),a.compareVersions(t.hostInfo.toolbarVersion,t.CONSTS.PRICEGONG_HANDLED_GLOBALKEYS_VERSION)!==-1&&t.utils.setKey(t.keys.pgUnloadedOnce,"true"),n.resolve()}),n.promise()},H=function(){(t.platform.type==="EXT"||$.browser.mozilla||$.browser.msie)&&setTimeout(function(){h.resolve()},4e3)},B=function(){for(appId in t.knownApps)if(t.knownApps.hasOwnProperty(appId)&&!t.knownApps[appId].appState())return!1;return!0},j=function(){var n=$.Deferred(),r=t.utils.getKey(t.keys.firstTime)!=="1",i=a.parseBoolFromStorage(t.utils.getKey(t.keys.mamPreapprovedByInstaller)),s=t.settings.Data.isWelcomeExperienceEnabledByDefault,o=a.parseBoolFromStorage(t.utils.getKey(t.keys.mamEnabled)),f={},l=!1,c=t.CONSTS.MAIN_DIALOG.MODE.NORMAL,h,p=t.utils.getKey(t.keys.existingUsersRecoveryDone),d=t.utils.getKey(t.keys.newWelcomeExperience);switch(t.flavor){case t.CONSTS.FLAVORS.FREEGO:return t.utils.setKey(t.keys.firstTime,"1"),n.resolve({showWelcome:!0,appsDefaultEnabled:!0}),n.promise();case t.CONSTS.FLAVORS.STANDALONE:return n.resolve({showWelcome:!1,appsDefaultEnabled:r?!0:null}),t.utils.setKey(t.keys.firstTime,"1"),n.promise();case t.CONSTS.FLAVORS.TOOLBAR:default:}if(r){if(i===!0)l=!1,h=!0,c=t.CONSTS.MAIN_DIALOG.MODE.NORMAL;else if(o===!0)h=!0,l=!1,c=t.CONSTS.MAIN_DIALOG.MODE.NORMAL;else if(o===!1)l=!t.utils.isSpecialPage(e.getMainFrameUrl()),h=s,c=s?t.CONSTS.MAIN_DIALOG.MODE.NORMAL:t.CONSTS.MAIN_DIALOG.MODE.FIRST_TIME;else if(t.settings&&t.settings.Data&&t.settings.Data.UserCountryCode){var v=t.settings.Data.UserCountryCode.toUpperCase();v==="US"||v==="CA"?(l=!1,h=!0,c=t.CONSTS.MAIN_DIALOG.MODE.NORMAL):(l=!t.utils.isSpecialPage(e.getMainFrameUrl()),h=s,c=s?t.CONSTS.MAIN_DIALOG.MODE.NORMAL:t.CONSTS.MAIN_DIALOG.MODE.FIRST_TIME)}C(h),u.sendUsage({category:"FirstTime",action:i,label:h}),t.utils.setKey(t.keys.existingUsersRecoveryDone,"1"),t.utils.setKey(t.keys.newWelcomeExperience,"1")}else{if(!p){t.utils.setKey(t.keys.existingUsersRecoveryDone,"1");if(i!==!0){l=!1;if(B())h=null;else if(o===!0)h=!0,u.sendUsage({category:"ExistingUser",action:i,label:h});else if(o===!1)h=null;else if(t.settings&&t.settings.Data&&t.settings.Data.UserCountryCode){var v=t.settings.Data.UserCountryCode.toUpperCase();v==="US"||v==="CA"?h=!0:h=null}h!==null&&C(h)}}if(d){var m=t.utils.getKey(t.keys.dialogInteracted)=="1";c=m?t.CONSTS.MAIN_DIALOG.MODE.NORMAL:t.CONSTS.MAIN_DIALOG.MODE.FIRST_TIME}else c=t.CONSTS.MAIN_DIALOG.MODE.NORMAL}f={showWelcome:l,welcomeDialogMode:c,appsDefaultEnabled:h};var g=h?"true":h===null||typeof h=="undefined"?"unchanged":"false";return a.logString("Show welcome dialog: "+l+", apps enabled by default: "+g),r&&t.utils.setKey(t.keys.firstTime,"1"),n.resolve(f),n.promise()},F=function(){$.browser.msie&&($.support.cors=!0),l.upgradeVersion()},I=function(e){var n;for(n in e)if(e.hasOwnProperty(n)){if(e[n]===null||typeof e[n]=="undefined")e[n]="null";t.utils.setKey(t.keys[n],e[n].toString())}},q=function(){t.utils.setKey(t.keys.dialogInteracted,t.utils.getKey(t.keys.welcomeDialogMode))},R=function(){var e=this;F.call(this);var r=function(){switch(t.flavor){case t.CONSTS.FLAVORS.FREEGO:case t.CONSTS.FLAVORS.STANDALONE:return[$.Deferred(t.utils.waitForPlatform)];case t.CONSTS.FLAVORS.TOOLBAR:default:return[$.Deferred(t.utils.waitForToolbar),$.Deferred(t.utils.waitForPlatform),$.Deferred(P)]}}();$.when(r).then(function(){$.when(n.checkServices()).always(function(r){L(),n.login();if(r.state()!=="resolved")return;D.call(e),S(),T.call(e),H(),$.when(h.promise()).done(function(){$.when(j()).done(function(r){p.resolve(),I(r),q(),n.reportAppsState(),o.bindEvents(),r.showWelcome&&(t.flavor!==t.CONSTS.FLAVORS.FREEGO?g.call(e,{view:"welcome"}):t.utils.openNewPage("welcome.html"))}).fail(function(){})})})})},U=function(e){o.updateBadgeNumber("!")};return{start:R,launchDialog:g,handleBadge:x}}),require.config({paths:{mamLib:"libs/mamLib",polyfill:"polyfills/polyfill",mamController:"controllers/mamController",mamView:"views/mamView",services:"modules/services",Login:"modules/Login",DMP:"modules/DMP",App:"modules/App",usage:"modules/usage",WebApp:"modules/WebApp",domains:"modules/criterias/domains",locales:"modules/criterias/locale",time:"modules/criterias/time",utils:"modules/utils",pubsub:"modules/events-app-api",mamApi:"modules/app-api-wrapper",upgrader:"modules/upgrader",rolloutHelper:"modules/rollout-helper",fallback:"modules/fallback"}}),require(["mamController"],function(e){$(function(){setTimeout(function(){e.start()},1e3)})}),define("../scripts/main-mam",function(){})